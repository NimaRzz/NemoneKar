@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Add";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="row w-100">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <h4 class="mt-0 header-title">افزودن کاربر جدید</h4>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="form-group row">
                            <label for="username" class="col-sm-2 col-form-label text-right">نام کاربری</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="text" id="username">
                            </div>
                        </div>
                        
                        <div class="form-group row">
                            <label for="RoleIds" class="col-sm-2 col-form-label text-right">نقش ها:</label>
                            <select class="form-select" name="RoleIds" id="RoleIds" asp-items="@ViewBag.Roles" multiple>
                            </select>
                        </div>
                        
                        <div class="form-group row">
                            <label for="email" class="col-sm-2 col-form-label text-right">پست الکترونیک</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="email" id="email">
                            </div>
                        </div>
                      
                        <div class="form-group row">
                            <label for="password" class="col-sm-2 col-form-label text-right">رمز عبور</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="password" id="password">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="isAdmin" class="col-sm-2 col-form-label text-right">ادمین</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="checkbox" id="isAdmin">
                            </div>
                        </div>
                        
                        <div class="form-group row">
                            <label for="isActive" class="col-sm-2 col-form-label text-right">فعال</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="checkbox" id="isActive">
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-10">
                               <button class="btn btn-success" id="addButton" onclick="AddUser()">افزودن</button>
                            </div>
                        </div>

                    </div>


                </div>
            </div><!--end card-body-->
        </div><!--end card-->
    </div><!--end col-->
</div>

@section Scripts{

<link href="~/Sweetalert2/sweetalert2.min.css" rel="stylesheet"/>
<script src="~/Sweetalert2/sweetalert2.min.js"></script>

<script>
    
    function AddUser() {
       

        swal.fire({
            title: 'افزودن کاربر جدید',
                text: 'از افزودن کاربر جدید مطمئن هستید؟',
            icon: 'info',
            showCancelButton: true,
            cancelButtonColor: '#fc0000',
            confirmButtonColor: '#039e00',
            cancelButtonText: 'خیر',
            confirmButtonText: 'بله، افزودن کاربر جدید انجام شود'

        }).then((result) => {
            if (result.value) {


                var data = new FormData();

                var roles = [];
                $("#RoleIds option:selected").each(function(){
                    roles.push($(this).val());
                });

                data.append('Email', $("#email").val());
                data.append('Password', $("#password").val());
                data.append('RoleIds', JSON.stringify(roles));
                data.append('UserName', $("#username").val());
                data.append('IsAdmin', $("#isAdmin").is(":checked"));
                data.append('isActive', $("#isActive").is(":checked"));
               
            

            }


            $.ajax({              
                type: 'POST',
                contentType: false,
                processData: false,
                url: '/admin/users/Add',
                data: data,
                success: function (data) {
                    if (data.isSuccess == true) {
                        swal.fire(
                            'موفق',
                            data.message,
                            'success'
                        ).then(function (isConfirm) {
                            if($('#redirectToCustomers').val() == 'true'){
                                window.location.replace("/admin/customers");
                            }
                            else{
                                 window.location.replace("/admin/users");
                            }
                           

                        });
                    }
                    else {
                        swal.fire(
                            'هشدار',
                            data.message,
                            'warning'
                        );
                    }
                },
                error: function (xhr, ajaxOption, thrownError) {

                    alert(xhr.status);
                    alert(thrownError);

                }

            });

        })
    }

</script>

}